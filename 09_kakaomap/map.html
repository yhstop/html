<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kakao Maps API 주소/장소 검색 지도</title>
  <style>
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .wrap { padding: 16px; }
    .controls { display:flex; gap:8px; align-items:center; margin: 0 0 12px; }
    .controls input {
      flex: 1;
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 14px;
      outline: none;
    }
    .controls button {
      padding: 10px 14px;
      border: 1px solid #ddd;
      background: #fff;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
    }
    .controls button:active { transform: translateY(1px); }

    /* 지도가 들어갈 영역은 반드시 width/height가 있어야 합니다 */
    #map { width: 100%; height: 460px; border-top: 1px solid #eee; }

    .hint { margin:12px 0 0; color:#555; font-size:13px; line-height: 1.4; }
    code { background: #f6f6f6; padding: 2px 6px; border-radius: 6px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1 style="margin:0 0 12px; font-size:18px;">maps 검색 → 해당 지역 검색</h1>

    <div class="controls">
      <input id="keyword" type="text" placeholder="예) 서울시청, 강남역, 제주도" />
      <button id="searchBtn" type="button">검색</button>
    </div>

    <div id="map"></div>

  </div>

  <!-- 1) Kakao Maps SDK 로드 (services 라이브러리 포함) -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=3ca8f8ca6e23307fccc79051a54d9f4a&libraries=services"></script>

  <!-- 2) 지도 + 키워드 검색 -->
  <script>
    // 초기 중심좌표(예: 서울 시청)
    const defaultLat = 37.5665;
    const defaultLng = 126.9780;

    const mapContainer = document.getElementById('map');
    const map = new kakao.maps.Map(mapContainer, {
      center: new kakao.maps.LatLng(defaultLat, defaultLng),
      level: 4,
    });

    // 검색 서비스(장소 검색)
    const places = new kakao.maps.services.Places();

    // 마커/인포윈도우(재사용)
    const marker = new kakao.maps.Marker({
      position: map.getCenter(),
    });
    marker.setMap(map);

    const info = new kakao.maps.InfoWindow({ zIndex: 1 });

    function showPlace(place) {
      const lat = Number(place.y);
      const lng = Number(place.x);
      const pos = new kakao.maps.LatLng(lat, lng);

      map.setCenter(pos);
      marker.setPosition(pos);

      const name = place.place_name || '검색 결과';
      const addr = place.road_address_name || place.address_name || '';
      info.setContent(
        '<div style="padding:8px 10px; font-size:12px; line-height:1.35;">'
        + '<div style="font-weight:600; margin-bottom:2px;">' + escapeHtml(name) + '</div>'
        + (addr ? '<div style="color:#555;">' + escapeHtml(addr) + '</div>' : '')
        + '</div>'
      );
      info.open(map, marker);
    }

    function doSearch() {
      const keywordEl = document.getElementById('keyword');
      const keyword = (keywordEl.value || '').trim();

      if (!keyword) {
        alert('검색어를 입력해주세요.');
        keywordEl.focus();
        return;
      }

      // keywordSearch는 장소/키워드 기반으로 결과를 반환합니다.
      places.keywordSearch(keyword, function (data, status) {
        if (status === kakao.maps.services.Status.OK && data && data.length) {
          // 가장 첫 번째 결과를 지도에 표시
          showPlace(data[0]);
        } else if (status === kakao.maps.services.Status.ZERO_RESULT) {
          alert('검색 결과가 없습니다. 다른 검색어로 시도해보세요.');
        } else {
          // ERROR 등
          alert('검색 중 오류가 발생했습니다. (status: ' + status + ')');
        }
      });
    }

    // 버튼 클릭 / Enter 키로 검색
    document.getElementById('searchBtn').addEventListener('click', doSearch);
    document.getElementById('keyword').addEventListener('keydown', function (e) {
      if (e.key === 'Enter') doSearch();
    });

    // 아주 간단한 XSS 방지용 escape
    function escapeHtml(str) {
      return String(str)
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#039;');
    }

    // 초기 안내(원하면 제거 가능)
    info.setContent('<div style="padding:8px 10px; font-size:12px;">검색어를 입력하고 검색을 눌러보세요.</div>');
    info.open(map, marker);
  </script>
</body>
</html>
