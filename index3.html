<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kakao Map API Example</title>
  <style>
    /* 지도가 표시될 영역의 크기가 반드시 필요합니다 */
    #map { width: 100%; height: 420px; }
    body { margin: 0; padding: 16px; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 12px; }
    input { padding: 10px 12px; min-width: 260px; }
    button { padding: 10px 12px; cursor: pointer; }
    .hint { color: #555; font-size: 14px; }
  </style>
</head>
<body>
  <h1 style="margin:0 0 8px; font-size:20px;">카카오맵 API 지도 표시</h1>
  <p class="hint" style="margin:0 0 12px;">
    1) 아래 스크립트의 <code>YOUR_APP_KEY</code>를 카카오 개발자 콘솔에서 발급받은 JavaScript 키로 바꾸세요.
    2) (권장) 개발자 콘솔에서 도메인 등록을 해두세요.
  </p>

  <div class="row">
    <input id="keyword" placeholder="장소 검색어 (예: 강남역)" />
    <button id="btnSearch" type="button">검색 후 이동</button>
    <button id="btnMy" type="button">내 위치로 이동</button>
  </div>

  <div id="map" aria-label="kakao map"></div>

  <!-- ✅ Kakao Maps JavaScript SDK 로드
       appkey=YOUR_APP_KEY 를 실제 JavaScript 키로 교체하세요.
       libraries=services 는 장소검색(키워드 검색)에 필요합니다. -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=3ca8f8ca6e23307fccc79051a54d9f4a"></script>

  <script>
    // 1) 초기 지도 생성 (서울 시청 근처)
    const container = document.getElementById('map');
    const options = {
      center: new kakao.maps.LatLng(37.5665, 126.9780),
      level: 5,
    };
    const map = new kakao.maps.Map(container, options);

    // 2) 마커(기본 1개)
    const marker = new kakao.maps.Marker({
      position: map.getCenter(),
    });
    marker.setMap(map);

    // 3) 지도 클릭 시 마커 이동 + 좌표 표시(콘솔)
    kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
      const latlng = mouseEvent.latLng;
      marker.setPosition(latlng);
      console.log('클릭 좌표:', latlng.getLat(), latlng.getLng());
    });

    // 4) 키워드 장소검색으로 지도 이동
    const ps = new kakao.maps.services.Places();

    function moveToKeyword(keyword) {
      return new Promise((resolve, reject) => {
        if (!keyword || !keyword.trim()) {
          reject(new Error('검색어가 비어있습니다.'));
          return;
        }
        ps.keywordSearch(keyword, (data, status) => {
          if (status !== kakao.maps.services.Status.OK || !data || data.length === 0) {
            reject(new Error('검색 결과가 없습니다.'));
            return;
          }
          const first = data[0];
          const lat = Number(first.y);
          const lng = Number(first.x);
          const pos = new kakao.maps.LatLng(lat, lng);
          map.setCenter(pos);
          marker.setPosition(pos);
          resolve({ name: first.place_name, lat, lng });
        });
      });
    }

    document.getElementById('btnSearch').addEventListener('click', async () => {
      try {
        const keyword = document.getElementById('keyword').value;
        const result = await moveToKeyword(keyword);
        console.log('이동:', result);
      } catch (e) {
        alert(e.message);
      }
    });

    // 5) 내 위치로 이동 (브라우저 위치 권한 필요)
    document.getElementById('btnMy').addEventListener('click', () => {
      if (!navigator.geolocation) {
        alert('이 브라우저는 Geolocation을 지원하지 않습니다.');
        return;
      }
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const lat = pos.coords.latitude;
          const lng = pos.coords.longitude;
          const my = new kakao.maps.LatLng(lat, lng);
          map.setCenter(my);
          marker.setPosition(my);
        },
        (err) => {
          console.warn(err);
          alert('위치 정보를 가져오지 못했습니다. (권한/HTTPS 여부 확인)');
        }
      );
    });
  </script>
</body>
</html>
